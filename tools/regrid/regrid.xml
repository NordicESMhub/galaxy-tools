<tool id="regrid" name="regridding_to_EASE" version="0.1.0+galaxy0" python_template_version="3.5" profile="21.05">
<description>for regridding netcdf files to EASE</description>
    <requirements>
        <requirement type="package" version="3.7.6">python</requirement>
        <requirement type="package" version="0.16.2">xarray</requirement>
        <requirement type="package" version="1.19">numpy</requirement>
        <requirement type="package" version="1.0">pandas</requirement>
        <requirement type="package" version="1.6">scipy</requirement>
        <requirement type="package" version="2.4">iris</requirement>
        <requirement type="package" version="1.5">netcdf4</requirement>
        <requirement type="package" version="2.8">imageio</requirement>
        <requirement type="package" version="3.1">matplotlib</requirement>
        <requirement type="package" version="4.58">tqdm</requirement>
        <requirement type="package" version="0.1">cdsapi</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        python3 '$__tool_directory__/gen_masks.py' &&
        #if str($is_siconca.siconca).strip() == 'yes'
            python3 '$__tool_directory__/prepare_sic_data.py' --input $nc_file       &&
            mv "data/obs/siconca_EASE.nc" "regridded_data.nc"
        #else
            python3 '$__tool_directory__/prepare_era5_data.py' --input $nc_file --var $is_siconca.era5_variable             &&
            mv "data/obs/${is_siconca.era5_variable}_EASE.nc" "regridded_data.nc"  && 
        #end if                                  &&
        echo "regridding is done"
    ]]></command>
    <inputs>
        <param name="nc_file" type="data" label="netcdf file" format="netcdf"/>
        <conditional name="is_siconca">
            <param name="siconca" type="select" label="input variable is sea ice concentration">
                <option value="yes" selected="false">yes</option>
                <option value="no">no</option>
            </param>
            <when value="yes">
            </when>
            <when value="no">
                <param name="era5_variable" type="text"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="ofilename" format="netcdf" from_work_dir= "regridded_data.nc"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="nc_file" value="tas_latlon.nc"/>
            <param name="siconca" value="no"/>
            <param name="era5_variable" value="tas"/>
            <output name="ofilename" ftype="netcdf">
                <assert_contents>
                    <has_size value="5996497" delta="100"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[

        This tool is a wrapper to regrid netcdf files.
    ]]></help>
    <citations>
        <citation type="bibtex"> 
            @misc{https://doi.org/10.5281/zenodo.5176573,
                doi = {10.5281/ZENODO.5176573},
                url = {https://zenodo.org/record/5176573},
                author = {Andersson,  Tom R.},
                title = {Code associated with the paper: 'Seasonal Arctic sea ice forecasting with probabilistic deep learning'},
                publisher = {Zenodo},
                year = {2021},
                copyright = {Open Access}
              }
        </citation>
    </citations>
</tool>
